apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: ecommerce

bases:
  - ../../base

# Adicionar recursos específicos da v2
resources:
  - ecommerce-ui-backend.yaml
  - ecommerce-ui-v2-proxy.yaml
  - configmap-nginx-v2.yaml

# Labels específicos da v2
commonLabels:
  version: v2
  environment: production

# Remover deployment ecommerce-ui original (usar apenas v2)
patches:
  - target:
      kind: Deployment
      name: ecommerce-ui
    patch: |-
      $patch: delete
  - target:
      kind: Service
      name: ecommerce-ui
    patch: |-
      - op: replace
        path: /spec/selector
        value:
          app: ecommerce-ui
          version: v2
