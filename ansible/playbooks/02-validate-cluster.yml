---
- name: Validação completa do Cluster EKS
  hosts: localhost
  gather_facts: false
  
  vars:
    kubeconfig_path: "~/.kube/config"
  
  pre_tasks:
    - name: Verificar kubectl disponível
      command: kubectl version --client
      changed_when: false
      failed_when: false
      register: kubectl_check

    - name: Validar kubeconfig existe
      stat:
        path: "{{ kubeconfig_path }}"
      register: kubeconfig_stat
      failed_when: not kubeconfig_stat.stat.exists

  roles:
    - cluster-validation

  post_tasks:
    - name: "✅ Validação concluída"
      debug:
        msg: "Cluster está saudável!"
